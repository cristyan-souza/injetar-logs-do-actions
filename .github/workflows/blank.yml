name: Enviar 10 logs para Loki

on:
  push:
    branches: [ main ]

jobs:
  enviar-logs:
    runs-on: ubuntu-latest

    steps:
      - name: Enviar mÃºltiplos logs para Loki via ngrok
        run: |
          for i in {1..10}; do
            TIMESTAMP=$(($(date +%s%N)))
            JSON=$(jq -n \
              --arg ts "$TIMESTAMP" \
              --arg msg "ðŸ§ª Log #$i do GitHub Actions Ã s $TIMESTAMP" \
              '{streams: [{stream: {job: "github-actions", level: "info"}, values: [[ $ts, $msg ]]}]}')
            echo "$JSON" > log.json
            curl -s -X POST http://loki.grafana.svc.cluster.local:3100 \
              -H "Content-Type: application/json" \
              --data-binary "@log.json"
            sleep 1
          done
